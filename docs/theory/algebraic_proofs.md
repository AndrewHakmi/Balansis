# –ê–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏–µ –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ –ö—Ä–∞–µ–≤—ã–µ –°–ª—É—á–∞–∏ ACT

## 1. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –¢–µ–æ—Ä–µ–º

### 1.1 –î–µ—Ç–∞–ª—å–Ω–æ–µ –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –ì—Ä—É–ø–ø–æ–≤—ã—Ö –°–≤–æ–π—Å—Ç–≤

**–¢–µ–æ—Ä–µ–º–∞ 1.1 (–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è):** –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π ùíú —Å –æ–ø–µ—Ä–∞—Ü–∏–µ–π –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ª–æ–∂–µ–Ω–∏—è ‚äï –æ–±—Ä–∞–∑—É–µ—Ç –∞–±–µ–ª–µ–≤—É –≥—Ä—É–ø–ø—É (ùíú, ‚äï).

#### –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –ê—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–î–µ—Ç–∞–ª—å–Ω–æ–µ)

–î–ª—è –ª—é–±—ã—Ö ùíú‚ÇÅ = (m‚ÇÅ, d‚ÇÅ), ùíú‚ÇÇ = (m‚ÇÇ, d‚ÇÇ), ùíú‚ÇÉ = (m‚ÇÉ, d‚ÇÉ) ‚àà ùíú –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–∫–∞–∑–∞—Ç—å:
```
(ùíú‚ÇÅ ‚äï ùíú‚ÇÇ) ‚äï ùíú‚ÇÉ = ùíú‚ÇÅ ‚äï (ùíú‚ÇÇ ‚äï ùíú‚ÇÉ)
```

**–°–ª—É—á–∞–π 1:** –í—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã (d‚ÇÅ = d‚ÇÇ = d‚ÇÉ = d)
```
–õ–µ–≤–∞—è —á–∞—Å—Ç—å: ((m‚ÇÅ + m‚ÇÇ), d) ‚äï (m‚ÇÉ, d) = (m‚ÇÅ + m‚ÇÇ + m‚ÇÉ, d)
–ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: (m‚ÇÅ, d) ‚äï ((m‚ÇÇ + m‚ÇÉ), d) = (m‚ÇÅ + m‚ÇÇ + m‚ÇÉ, d)
```
–†–∞–≤–µ–Ω—Å—Ç–≤–æ —Å–ª–µ–¥—É–µ—Ç –∏–∑ –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–ª–æ–∂–µ–Ω–∏—è –≤ ‚Ñù.

**–°–ª—É—á–∞–π 2:** –î–≤–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã, –æ–¥–Ω–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è
–ü—É—Å—Ç—å d‚ÇÅ = d‚ÇÇ = +1, d‚ÇÉ = -1. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø–æ–¥—Å–ª—É—á–∞–∏:

*–ü–æ–¥—Å–ª—É—á–∞–π 2.1:* m‚ÇÅ + m‚ÇÇ > m‚ÇÉ
```
–õ–µ–≤–∞—è —á–∞—Å—Ç—å: (m‚ÇÅ + m‚ÇÇ, +1) ‚äï (m‚ÇÉ, -1) = (m‚ÇÅ + m‚ÇÇ - m‚ÇÉ, +1)
–ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: (m‚ÇÅ, +1) ‚äï (m‚ÇÇ - m‚ÇÉ, sign(m‚ÇÇ - m‚ÇÉ))
```
–ï—Å–ª–∏ m‚ÇÇ ‚â• m‚ÇÉ: –ø—Ä–∞–≤–∞—è —á–∞—Å—Ç—å = (m‚ÇÅ + m‚ÇÇ - m‚ÇÉ, +1) ‚úì
–ï—Å–ª–∏ m‚ÇÇ < m‚ÇÉ: –ø—Ä–∞–≤–∞—è —á–∞—Å—Ç—å = (m‚ÇÅ, +1) ‚äï (m‚ÇÉ - m‚ÇÇ, -1) = (m‚ÇÅ - m‚ÇÉ + m‚ÇÇ, sign(m‚ÇÅ - m‚ÇÉ + m‚ÇÇ))

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–¥—Å–ª—É—á–∞–∏.

**–°–ª—É—á–∞–π 3:** –í—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã
–≠—Ç–æ—Ç —Å–ª—É—á–∞–π –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω, —Ç–∞–∫ –∫–∞–∫ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Ç–æ–ª—å–∫–æ –¥–≤–∞ –∑–Ω–∞—á–µ–Ω–∏—è {-1, +1}.

#### –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –û–±—Ä–∞—Ç–Ω–æ–≥–æ –≠–ª–µ–º–µ–Ω—Ç–∞

–î–ª—è –∫–∞–∂–¥–æ–≥–æ ùíú = (m, d) ‚àà ùíú –æ–ø—Ä–µ–¥–µ–ª–∏–º ùíú‚Åª¬π = (m, -d).

–ü—Ä–æ–≤–µ—Ä–∏–º: ùíú ‚äï ùíú‚Åª¬π = (m, d) ‚äï (m, -d)

–ü–æ—Å–∫–æ–ª—å–∫—É d ‚â† -d –∏ m = m, –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ª–æ–∂–µ–Ω–∏—è:
```
ùíú ‚äï ùíú‚Åª¬π = ùî∏ = (0, +1)
```

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ: ùíú‚Åª¬π ‚äï ùíú = ùî∏.

### 1.2 –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –ü–æ–ª–µ–≤—ã—Ö –°–≤–æ–π—Å—Ç–≤ –¥–ª—è –í–µ—á–Ω—ã—Ö –û—Ç–Ω–æ—à–µ–Ω–∏–π

**–¢–µ–æ—Ä–µ–º–∞ 1.2:** –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–µ—á–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π ‚Ñ∞* = ‚Ñ∞ \ {(ùíú, ùî∏) : ùíú ‚àà ùíú} —Å –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ ‚äï –∏ ‚äô –æ–±—Ä–∞–∑—É–µ—Ç –ø–æ–ª–µ.

#### –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –î–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–Ω–æ—Å—Ç–∏

–î–ª—è ‚Ñ∞‚ÇÅ = (ùíú‚Çô‚ÇÅ, ùíú‚Çê‚ÇÅ), ‚Ñ∞‚ÇÇ = (ùíú‚Çô‚ÇÇ, ùíú‚Çê‚ÇÇ), ‚Ñ∞‚ÇÉ = (ùíú‚Çô‚ÇÉ, ùíú‚Çê‚ÇÉ) ‚àà ‚Ñ∞*:

```
‚Ñ∞‚ÇÅ ‚äô (‚Ñ∞‚ÇÇ ‚äï ‚Ñ∞‚ÇÉ) = ‚Ñ∞‚ÇÅ ‚äô ‚Ñ∞‚ÇÇ ‚äï ‚Ñ∞‚ÇÅ ‚äô ‚Ñ∞‚ÇÉ
```

–õ–µ–≤–∞—è —á–∞—Å—Ç—å:
```
‚Ñ∞‚ÇÇ ‚äï ‚Ñ∞‚ÇÉ = (ùíú‚Çô‚ÇÇ ‚äô ùíú‚Çê‚ÇÉ ‚äï ùíú‚Çô‚ÇÉ ‚äô ùíú‚Çê‚ÇÇ, ùíú‚Çê‚ÇÇ ‚äô ùíú‚Çê‚ÇÉ)
‚Ñ∞‚ÇÅ ‚äô (‚Ñ∞‚ÇÇ ‚äï ‚Ñ∞‚ÇÉ) = (ùíú‚Çô‚ÇÅ ‚äô (ùíú‚Çô‚ÇÇ ‚äô ùíú‚Çê‚ÇÉ ‚äï ùíú‚Çô‚ÇÉ ‚äô ùíú‚Çê‚ÇÇ), ùíú‚Çê‚ÇÅ ‚äô ùíú‚Çê‚ÇÇ ‚äô ùíú‚Çê‚ÇÉ)
```

–ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å:
```
‚Ñ∞‚ÇÅ ‚äô ‚Ñ∞‚ÇÇ = (ùíú‚Çô‚ÇÅ ‚äô ùíú‚Çô‚ÇÇ, ùíú‚Çê‚ÇÅ ‚äô ùíú‚Çê‚ÇÇ)
‚Ñ∞‚ÇÅ ‚äô ‚Ñ∞‚ÇÉ = (ùíú‚Çô‚ÇÅ ‚äô ùíú‚Çô‚ÇÉ, ùíú‚Çê‚ÇÅ ‚äô ùíú‚Çê‚ÇÉ)
‚Ñ∞‚ÇÅ ‚äô ‚Ñ∞‚ÇÇ ‚äï ‚Ñ∞‚ÇÅ ‚äô ‚Ñ∞‚ÇÉ = ((ùíú‚Çô‚ÇÅ ‚äô ùíú‚Çô‚ÇÇ) ‚äô (ùíú‚Çê‚ÇÅ ‚äô ùíú‚Çê‚ÇÉ) ‚äï (ùíú‚Çô‚ÇÅ ‚äô ùíú‚Çô‚ÇÉ) ‚äô (ùíú‚Çê‚ÇÅ ‚äô ùíú‚Çê‚ÇÇ), (ùíú‚Çê‚ÇÅ ‚äô ùíú‚Çê‚ÇÇ) ‚äô (ùíú‚Çê‚ÇÅ ‚äô ùíú‚Çê‚ÇÉ))
```

–ò—Å–ø–æ–ª—å–∑—É—è –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–∫–∞–ª—è—Ä–Ω–æ–≥–æ —É–º–Ω–æ–∂–µ–Ω–∏—è –Ω–∞–¥ –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–ª–æ–∂–µ–Ω–∏–µ–º:
```
ùíú‚Çô‚ÇÅ ‚äô (ùíú‚Çô‚ÇÇ ‚äô ùíú‚Çê‚ÇÉ ‚äï ùíú‚Çô‚ÇÉ ‚äô ùíú‚Çê‚ÇÇ) = ùíú‚Çô‚ÇÅ ‚äô ùíú‚Çô‚ÇÇ ‚äô ùíú‚Çê‚ÇÉ ‚äï ùíú‚Çô‚ÇÅ ‚äô ùíú‚Çô‚ÇÉ ‚äô ùíú‚Çê‚ÇÇ
```

–ß—Ç–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —á–∏—Å–ª–∏—Ç–µ–ª–µ–º –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏.

## 2. –ü–æ–ª–Ω–∞—è –¢–∞–±–ª–∏—Ü–∞ –ö—Ä–∞–µ–≤—ã—Ö –°–ª—É—á–∞–µ–≤

### 2.1 –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ê–±—Å–æ–ª—é—Ç–æ–º

| –û–ø–µ—Ä–∞—Ü–∏—è | –õ–µ–≤—ã–π –æ–ø–µ—Ä–∞–Ω–¥ | –ü—Ä–∞–≤—ã–π –æ–ø–µ—Ä–∞–Ω–¥ | –†–µ–∑—É–ª—å—Ç–∞—Ç | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|----------|---------------|----------------|-----------|-------------|
| ‚äï | ùî∏ | (m, d) | (m, d) | –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç—å –∞–±—Å–æ–ª—é—Ç–∞ |
| ‚äï | (m, d) | ùî∏ | (m, d) | –ö–æ–º–º—É—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç—å |
| ‚äï | ùî∏ | ùî∏ | ùî∏ | –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å |
| ‚äô | 0 | (m, d) | ùî∏ | –ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ |
| ‚äô | Œª ‚â† 0 | ùî∏ | ùî∏ | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–±—Å–æ–ª—é—Ç–∞ |

### 2.2 –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏–æ–Ω–Ω—ã–µ –°–ª—É—á–∞–∏

| –°–ª—É—á–∞–π | –û–ø–µ—Ä–∞–Ω–¥—ã | –†–µ–∑—É–ª—å—Ç–∞—Ç | –¢–∏–ø –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ |
|--------|----------|-----------|-----------------|
| –ü–æ–ª–Ω–∞—è | (m, +1) ‚äï (m, -1) | ùî∏ | –°–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞—è |
| –ß–∞—Å—Ç–∏—á–Ω–∞—è | (m‚ÇÅ, +1) ‚äï (m‚ÇÇ, -1), m‚ÇÅ > m‚ÇÇ | (m‚ÇÅ-m‚ÇÇ, +1) | –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞—è |
| –ß–∞—Å—Ç–∏—á–Ω–∞—è | (m‚ÇÅ, +1) ‚äï (m‚ÇÇ, -1), m‚ÇÅ < m‚ÇÇ | (m‚ÇÇ-m‚ÇÅ, -1) | –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞—è |
| –£—Å–∏–ª–µ–Ω–∏–µ | (m‚ÇÅ, d) ‚äï (m‚ÇÇ, d) | (m‚ÇÅ+m‚ÇÇ, d) | –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–∞—è |

### 2.3 –í–µ—á–Ω—ã–µ –û—Ç–Ω–æ—à–µ–Ω–∏—è - –û—Å–æ–±—ã–µ –°–ª—É—á–∞–∏

| –ß–∏—Å–ª–∏—Ç–µ–ª—å | –ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å | –†–µ–∑—É–ª—å—Ç–∞—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|-------------|-----------|---------|
| ùî∏ | (m, d), m > 0 | (ùî∏, (m, d)) | val = 0 |
| (m, d), m > 0 | ùî∏ | –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ | –ò—Å–∫–ª—é—á–µ–Ω–∏–µ |
| (m‚ÇÅ, d‚ÇÅ) | (m‚ÇÇ, d‚ÇÇ) | (m‚ÇÅ/m‚ÇÇ, d‚ÇÅ¬∑d‚ÇÇ) | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π |
| (m, +1) | (m, +1) | –ï–¥–∏–Ω–∏—á–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ | val = 1 |
| (m, +1) | (m, -1) | –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –µ–¥–∏–Ω–∏—á–Ω–æ–µ | val = -1 |

### 2.4 –ì—Ä–∞–Ω–∏—á–Ω—ã–µ –ó–Ω–∞—á–µ–Ω–∏—è

| –¢–∏–ø | –£—Å–ª–æ–≤–∏–µ | –ü–æ–≤–µ–¥–µ–Ω–∏–µ | –û–±—Ä–∞–±–æ—Ç–∫–∞ |
|-----|---------|-----------|-----------|
| –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ | m > MAX_MAGNITUDE | –ù–∞—Å—ã—â–µ–Ω–∏–µ –¥–æ MAX_MAGNITUDE | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ |
| –ù–µ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ | 0 < m < MIN_MAGNITUDE | –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ ùî∏ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ |
| NaN | –í—Ö–æ–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ NaN | –ò—Å–∫–ª—é—á–µ–Ω–∏–µ | ValueError |
| ¬±‚àû | –í—Ö–æ–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ¬±‚àû | –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ (MAX_MAGNITUDE, ¬±1) | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ |

## 3. –ê–ª–≥–æ—Ä–∏—Ç–º—ã –û–±—Ä–∞–±–æ—Ç–∫–∏ –ö—Ä–∞–µ–≤—ã—Ö –°–ª—É—á–∞–µ–≤

### 3.1 –ê–ª–≥–æ—Ä–∏—Ç–º –ë–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –°–ª–æ–∂–µ–Ω–∏—è

```python
def safe_compensated_add(a1: AbsoluteValue, a2: AbsoluteValue) -> AbsoluteValue:
    """
    –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–ª–æ–∂–µ–Ω–∏–µ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∫—Ä–∞–µ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤
    """
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–±—Å–æ–ª—é—Ç
    if a1.magnitude == 0:
        return a2
    if a2.magnitude == 0:
        return a1
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ
    if a1.direction == a2.direction:
        if a1.magnitude + a2.magnitude > MAX_MAGNITUDE:
            return AbsoluteValue(MAX_MAGNITUDE, a1.direction)
        return AbsoluteValue(a1.magnitude + a2.magnitude, a1.direction)
    
    # –†–∞–∑–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    diff = abs(a1.magnitude - a2.magnitude)
    if diff < MIN_MAGNITUDE:
        return ABSOLUTE  # –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è
    
    if a1.magnitude > a2.magnitude:
        return AbsoluteValue(diff, a1.direction)
    elif a2.magnitude > a1.magnitude:
        return AbsoluteValue(diff, a2.direction)
    else:
        return ABSOLUTE  # –¢–æ—á–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è
```

### 3.2 –ê–ª–≥–æ—Ä–∏—Ç–º –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –í–µ—á–Ω—ã—Ö –û—Ç–Ω–æ—à–µ–Ω–∏–π

```python
def stabilize_eternal_ratio(ratio: EternalRatio, tolerance: float = 1e-10) -> EternalRatio:
    """
    –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –≤–µ—á–Ω–æ–≥–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —á–∏—Å–ª–µ–Ω–Ω–æ–π –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
    """
    num_mag = ratio.numerator.magnitude
    den_mag = ratio.denominator.magnitude
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–ª–∏–∑–æ—Å—Ç—å –∫ –Ω—É–ª—é –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è
    if den_mag < tolerance:
        raise ValueError("Denominator too close to absolute")
    
    # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è/–Ω–µ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
    if num_mag > MAX_MAGNITUDE / 2 or den_mag > MAX_MAGNITUDE / 2:
        scale_factor = MAX_MAGNITUDE / (2 * max(num_mag, den_mag))
        return EternalRatio(
            AbsoluteValue(num_mag * scale_factor, ratio.numerator.direction),
            AbsoluteValue(den_mag * scale_factor, ratio.denominator.direction)
        )
    
    return ratio
```

## 4. –¢–µ–æ—Ä–µ–º—ã –æ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

### 4.1 –¢–µ–æ—Ä–µ–º–∞ –æ –õ–æ–∫–∞–ª—å–Ω–æ–π –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

**–¢–µ–æ—Ä–µ–º–∞ 4.1:** –ü—É—Å—Ç—å f: ùíú¬≤ ‚Üí ùíú - –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–ª–æ–∂–µ–Ω–∏–µ. –¢–æ–≥–¥–∞ –¥–ª—è –ª—é–±–æ–≥–æ Œµ > 0 —Å—É—â–µ—Å—Ç–≤—É–µ—Ç Œ¥ > 0 —Ç–∞–∫–æ–µ, —á—Ç–æ –µ—Å–ª–∏ ‚Äñùíú‚ÇÅ - ùíú‚ÇÅ'‚Äñ < Œ¥ –∏ ‚Äñùíú‚ÇÇ - ùíú‚ÇÇ'‚Äñ < Œ¥, —Ç–æ ‚Äñf(ùíú‚ÇÅ, ùíú‚ÇÇ) - f(ùíú‚ÇÅ', ùíú‚ÇÇ')‚Äñ < Œµ.

**–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ:** –û–ø—Ä–µ–¥–µ–ª–∏–º –Ω–æ—Ä–º—É ‚Äñùíú‚Äñ = |œÜ(ùíú)| = |d¬∑m|.

–î–ª—è —Å–ª—É—á–∞—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```
‚Äñf(ùíú‚ÇÅ, ùíú‚ÇÇ) - f(ùíú‚ÇÅ', ùíú‚ÇÇ')‚Äñ = |(m‚ÇÅ + m‚ÇÇ) - (m‚ÇÅ' + m‚ÇÇ')| ‚â§ |m‚ÇÅ - m‚ÇÅ'| + |m‚ÇÇ - m‚ÇÇ'| < 2Œ¥
```

–í—ã–±–∏—Ä–∞—è Œ¥ = Œµ/2, –ø–æ–ª—É—á–∞–µ–º —Ç—Ä–µ–±—É–µ–º–æ–µ –Ω–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–æ.

### 4.2 –¢–µ–æ—Ä–µ–º–∞ –æ –ì–ª–æ–±–∞–ª—å–Ω–æ–π –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏

**–¢–µ–æ—Ä–µ–º–∞ 4.2:** –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ª–æ–∂–µ–Ω–∏—è —Å—Ö–æ–¥–∏—Ç—Å—è –∫ —Å—Ç–∞–±–∏–ª—å–Ω–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –ø—Ä–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ:** –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å {ùíú‚Çô}, –≥–¥–µ ùíú‚Çô‚Çä‚ÇÅ = ùíú‚Çô ‚äï Œµ‚Çô, –≥–¥–µ Œµ‚Çô - –º–∞–ª—ã–µ –≤–æ–∑–º—É—â–µ–Ω–∏—è.

–ï—Å–ª–∏ |Œµ‚Çô| ‚â§ Œµ –¥–ª—è –≤—Å–µ—Ö n, —Ç–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Å—Ç–∞–µ—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –∏ —Å—Ö–æ–¥–∏—Ç—Å—è –∫ –ø—Ä–µ–¥–µ–ª—É –≤ –º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ (ùíú, œÅ).

## 5. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 5.1 –í—ã–±–æ—Ä –¢–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç–∏

| –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|------------|----------------------------|-------------|
| –ù–∞—É—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è | 1e-12 | –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å |
| –ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã | 1e-8 | –ë–∞–ª–∞–Ω—Å —Ç–æ—á–Ω–æ—Å—Ç–∏/–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ |
| –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è | 1e-6 | –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –¥–µ–Ω–µ–∂–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü |
| –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ | 1e-4 | –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —à—É–º—É |

### 5.2 –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –û–±—Ä–∞–±–æ—Ç–∫–∏ –ò—Å–∫–ª—é—á–µ–Ω–∏–π

1. **–ü—Ä–µ–≤–µ–Ω—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
2. **Graceful degradation:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –±–ª–∏–∂–∞–π—à–∏–º –¥–æ–ø—É—Å—Ç–∏–º—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ó–∞–ø–∏—Å—å –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫—Ä–∞–µ–≤—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫—Ä–∞–µ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤ –≤ ACT*